# 游戏机制详解

## 1. 游戏核心系统

### 1.1 MudGame 类
**功能**: 游戏主入口，负责初始化、主循环和游戏状态管理

- **初始化功能**:
  - 通过 `start()` 方法启动游戏
  - 初始化玩家状态、当前位置和游戏系统

- **主循环机制**:
  - `gameLoop()` 方法处理玩家输入和游戏逻辑
  - 处理房间交互、物品使用、战斗触发等

- **存档管理**:
  - `loadGame()` 方法从指定存档加载游戏
  - 恢复玩家状态、位置和进度

- **状态检查**:
  - `checkGameState()` 方法监控游戏状态
  - 判断游戏胜利或失败条件

### 1.2 MapManager 类
**功能**: 管理游戏地图、房间连接和场景交互

- **地图初始化**:
  - `initializeMap()` 方法创建游戏世界
  - 定义并连接40+不同类型的房间
  - 设置各房间的物品、NPC和出口

- **房间管理**:
  - 实现房间之间的连接和转换
  - 管理房间内的实体（NPC、物品）

- **区域设计**:
  - 包含村庄、森林、山洞、城镇等多种场景
  - 实现区域主题和风格一致性

### 1.3 GameLauncher 类
**功能**: 游戏启动器，提供主菜单和游戏初始化

- **主菜单功能**:
  - 提供新游戏、加载存档、管理存档、退出选项
  - 通过数字选择（1-4）处理玩家选择

- **存档管理入口**:
  - 调用 GameLoader 进行存档操作

- **游戏初始化**:
  - 创建并初始化必要的游戏组件
  - 连接各个系统组件

## 2. 实体类系统

### 2.1 Room 类
**功能**: 定义游戏中的房间和场景

- **核心属性**:
  - 房间名称和描述
  - 出口集合（东、南、西、北等方向）
  - 物品和NPC集合

- **主要方法**:
  - `enterRoom()`: 玩家进入房间的处理逻辑
  - 管理房间内物品和NPC的添加与移除

### 2.2 Player 类
**功能**: 玩家角色，包含所有角色属性和游戏进度

- **基础属性**:
  - 角色名称、等级、经验值、金币
  - 当前位置和状态

- **战斗属性**:
  - HP、ATK、DEF等战斗相关属性
  - 战斗技能和状态效果

- **背包系统**:
  - 管理玩家拥有的物品
  - 物品使用、丢弃、交易等操作

- **任务系统**:
  - 跟踪已接受和完成的任务
  - 更新任务进度和领取奖励

- **主要方法**:
  - 移动、攻击、对话、使用物品、管理任务等
  - `updateTaskProgress()`: 更新任务完成进度

### 2.3 Item 类
**功能**: 游戏中所有物品的基类

- **核心属性**:
  - 名称、描述、ID、类型
  - 可使用/可装备属性
  - 效果值

- **主要方法**:
  - 使用物品 (applyEffect)
  - 展示物品信息 (displayInfo)

### 2.4 ItemType 枚举
**功能**: 定义物品的类型

- **类型列表**:
  - 武器 (WEAPON)
  - 防具 (ARMOR)
  - 药品 (POTION)
  - 钥匙 (KEY)
  - 线索 (CLUE)
  - 收集品 (COLLECTIBLE)
  - 消耗品 (CONSUMABLE)
  - 任务物品 (QUEST_ITEM)
  - 货币 (CURRENCY)
  - 特殊物品 (SPECIAL)
  - 材料 (MATERIAL)

### 2.5 物品详细列表

#### 2.5.1 武器类物品

1. **木剑**
   - **类型**: 武器
   - **描述**: 最基础的武器，适合新手使用
   - **效果**: 攻击力+2
   - **获取方式**: 初始装备或村庄武器店购买

2. **精铁剑**
   - **类型**: 武器
   - **描述**: 用精铁打造的长剑，比木剑锋利许多
   - **效果**: 攻击力+8
   - **获取方式**: 完成主线任务"山洞的邪恶"奖励

3. **净化法杖**
   - **类型**: 武器
   - **描述**: 具有净化之力的法杖，对邪物有额外伤害
   - **效果**: 攻击力+12，对邪物伤害+20%
   - **获取方式**: 完成支线任务"山顶净化"奖励

4. **狼牙项链**
   - **类型**: 武器/饰品
   - **描述**: 用野狼的牙齿制作的项链，带有野兽的力量
   - **效果**: 攻击力+3，攻击时有5%几率造成额外伤害
   - **获取方式**: 完成主线任务"森林的威胁"奖励

5. **武师秘籍**
   - **类型**: 武器/特殊
   - **描述**: 武师传授的拳法秘籍
   - **效果**: 学会新技能"猛虎拳"
   - **获取方式**: 完成支线任务"武师考验"奖励

#### 2.5.2 防具类物品

6. **粗布衣服**
   - **类型**: 防具
   - **描述**: 普通的粗布制成的衣服
   - **效果**: 防御力+1
   - **获取方式**: 初始装备或村庄防具店购买

7. **猎人徽章**
   - **类型**: 防具/饰品
   - **描述**: 猎人公会颁发的徽章，带有特殊力量
   - **效果**: 防御力+5，在森林中防御额外+2
   - **获取方式**: 完成支线任务"森林异变"奖励

8. **精钢护甲**
   - **类型**: 防具
   - **描述**: 用精钢打造的护甲，防御力出色
   - **效果**: 防御力+10
   - **获取方式**: 完成支线任务"珍贵矿石"奖励

9. **祈福符**
   - **类型**: 防具/饰品
   - **描述**: 老和尚加持过的护身符，能带来好运
   - **效果**: 增加幸运值，降低受到的暴击率
   - **获取方式**: 完成支线任务"古庙祈福"奖励

10. **净化宝珠**
    - **类型**: 防具/饰品
    - **描述**: 具有强大净化之力的宝珠
    - **效果**: 神秘力量+15，抵抗邪术攻击
    - **获取方式**: 完成支线任务"怨灵净化"奖励

#### 2.5.3 药品类物品

11. **草药**
    - **类型**: 药品
    - **描述**: 普通的草药，可以恢复少量生命
    - **效果**: 生命恢复+15
    - **获取方式**: 任务奖励、野外采集

12. **治疗药水**
    - **类型**: 药品
    - **描述**: 经过加工的治疗药水，恢复效果更好
    - **效果**: 生命恢复+30
    - **获取方式**: 完成支线任务"采集草药"奖励、客栈购买

13. **特制美酒**
    - **类型**: 药品/消耗品
    - **描述**: 客栈老板特制的美酒，不仅好喝还能恢复生命
    - **效果**: 生命恢复+25，临时增加少量攻击力
    - **获取方式**: 完成支线任务"客栈护卫"奖励

14. **药师的药剂**
    - **类型**: 药品
    - **描述**: 药师精心配制的高级药剂
    - **效果**: 生命恢复+40，解除中毒状态
    - **获取方式**: 完成支线任务"稀有草药"奖励

#### 2.5.4 特殊物品

15. **宝藏钥匙**
    - **类型**: 钥匙/特殊
    - **描述**: 打开宝藏大门的神秘钥匙
    - **效果**: 可以打开地下大厅的宝藏密室
    - **获取方式**: 完成支线任务"宝藏守护者"奖励

16. **商人的货物**
    - **类型**: 特殊/可交易
    - **描述**: 商人提供的珍贵货物，可以与其他NPC交易
    - **效果**: 用于触发额外的交易机会
    - **获取方式**: 完成支线任务"商人的请求"奖励

17. **净化粉末**
    - **类型**: 材料/特殊
    - **描述**: 用特殊草药制成的净化粉末
    - **效果**: 用于净化邪恶物品或区域
    - **获取方式**: 完成支线任务"净化材料"奖励

18. **书生的诗集**
    - **类型**: 特殊/线索
    - **描述**: 书生的诗集，记录了许多关于湖心亭的诗句
    - **效果**: 增加文化修养，解锁与其他NPC的特殊对话
    - **获取方式**: 完成支线任务"湖心亭之谜"奖励

19. **隐士的信物**
    - **类型**: 特殊/钥匙
    - **描述**: 女隐士给予的信物
    - **效果**: 可进入神秘地点"竹海深处"
    - **获取方式**: 完成支线任务"竹林清修"奖励

20. **隐士的智慧**
    - **类型**: 特殊/任务物品
    - **描述**: 隐士分享的人生智慧
    - **效果**: 触发后续任务，增加经验获取效率
    - **获取方式**: 完成支线任务"隐士的指引"奖励

#### 2.5.5 材料类物品

21. **木材**
    - **类型**: 材料
    - **描述**: 普通的木材，可用于制作或修理
    - **效果**: 任务道具，可交易给铁匠
    - **获取方式**: 森林中采集，完成支线任务"收集木材"所需

22. **稀有草药**
    - **类型**: 材料
    - **描述**: 罕见的草药，药效极佳
    - **效果**: 高级药品制作材料，完成支线任务"稀有草药"所需
    - **获取方式**: 特殊地点采集

23. **矿石**
    - **类型**: 材料
    - **描述**: 山洞中的矿石，可用于打造装备
    - **效果**: 高级装备制作材料，完成支线任务"珍贵矿石"所需
    - **获取方式**: 山洞中开采

### 2.4 NPC 类
**功能**: 游戏中的非玩家角色

- **核心属性**:
  - 名称、HP、ATK等战斗属性
  - 对话系统和任务相关字段

- **战斗能力**:
  - 攻击逻辑和属性克制计算
  - 不同NPC具有不同战斗策略

- **交互功能**:
  - `talk()`: 与玩家对话的方法
  - 提供任务和信息

## 3. 任务系统

### 3.1 Task 类
**功能**: 定义单个任务的结构和行为

- **核心属性**:
  - 任务ID、名称、描述
  - 任务目标列表和奖励
  - 任务状态（未接取/进行中/已完成）

- **主要方法**:
  - `updateProgress()`: 更新任务进度
  - 检查任务完成条件

### 3.2 TaskObjective 类
**功能**: 定义任务目标的类型和进度

- **目标类型**:
  - 击杀特定NPC
  - 收集特定物品
  - 到达特定位置
  - 与特定NPC对话

- **进度跟踪**:
  - 当前进度和目标数量
  - 进度更新和检查

### 3.3 TaskStatus 枚举
**功能**: 定义任务的不同状态

- **状态类型**:
  - `NOT_ACCEPTED`: 未接取
  - `IN_PROGRESS`: 进行中
  - `COMPLETED`: 已完成

- **状态中文映射**:
  - 提供状态的中文名称显示

### 3.4 TaskManager 类
**功能**: 管理游戏中所有任务

- **任务初始化**:
  - 初始化22个任务（3主线/19支线）
  - 设置任务触发条件和奖励

- **任务触发机制**:
  - 进入特定房间触发
  - 与特定NPC对话触发

- **任务跟踪**:
  - 管理活跃任务和已完成任务
  - 更新任务进度和状态

### 3.5 任务完成机制
**功能**: 详细说明任务从接受、进行到完成的整个流程

- **任务状态流转**:
  - 任务初始状态为 `NOT_ACCEPTED`
  - 玩家接受任务后状态变为 `IN_PROGRESS`
  - 任务完成后状态变为 `COMPLETED`

- **进度更新机制**:
  - **探索任务**: 玩家进入指定房间时自动更新
  - **击杀任务**: 玩家击败指定生物时自动更新
  - **收集任务**: 玩家获取指定物品时自动更新
  - **对话任务**: 玩家与指定NPC对话时自动更新

- **任务完成检查**:
  - `Task.updateProgress()` 方法更新进度计数
  - `Task.checkComplete()` 方法验证进度是否满足目标要求
  - 当 `currentCount >= targetCount` 时任务完成

- **奖励发放机制**:
  - 任务完成时自动发放奖励
  - 奖励包括: 经验值、侠义值、物品
  - 系统会创建奖励的独立副本发放给玩家

- **后续任务触发**:
  - `checkFollowUpTasks()` 方法根据已完成任务触发后续任务
  - 完成主线任务会解锁新的地图区域
  - 完成特定支线任务会影响NPC关系和解锁新内容

- **任务副本机制**:
  - 每个玩家拥有独立的任务副本
  - 任务实例隔离确保玩家间任务进度互不影响
  - 任务目标和奖励也创建了深度副本

### 3.6 任务详细列表

#### 3.6.1 主线任务 (3个)

1. **初来乍到**
   - **描述**: 作为新来的冒险者，你需要先了解这个村庄的情况
   - **目标**: 探索村庄，了解基本情况
   - **触发条件**: 进入村中心
   - **奖励**: 经验值50, 侠义值5
   - **完成方法**: 进入村中心区域后，系统自动记录探索进度，只需进入一次村中心区域，任务随即完成

2. **森林的威胁**
   - **描述**: 村庄附近的森林里有野狼出没，威胁着村民的安全
   - **目标**: 击败森林中的野狼 (1个)
   - **触发条件**: 进入森林
   - **奖励**: 经验值100, 侠义值10, 狼牙项链(攻击力+3)
   - **完成方法**: 在森林区域与野狼战斗并成功击败它，系统会自动记录击杀数量，累计击败1只野狼后任务完成

3. **山洞的邪恶**
   - **描述**: 山洞中的哥布林是更大的威胁，必须清除
   - **目标**: 击败山洞中的哥布林 (1个)
   - **触发条件**: 进入山洞
   - **奖励**: 经验值200, 侠义值20, 精铁剑(攻击力+8)
   - **完成方法**: 在山洞区域与哥布林战斗并成功击败它，系统会自动记录击杀数量，累计击败1只哥布林后任务完成

#### 3.6.2 支线任务 (19个)

4. **村民的忧虑**
   - **描述**: 村民似乎有什么烦恼，去和他聊聊
   - **目标**: 与村民对话 (1次)
   - **触发条件**: 与村民对话
   - **奖励**: 经验值25, 侠义值2, 草药(生命恢复+15)
   - **完成方法**: 在村庄区域找到村民并使用'talk'命令与其对话1次，完成对话后任务自动完成

5. **收集木材**
   - **描述**: 铁匠需要一些木材来修理工具
   - **目标**: 收集木材 (5个)
   - **触发条件**: 与铁匠对话
   - **奖励**: 经验值75, 侠义值3, 金币
   - **完成方法**: 在森林或其他可收集区域寻找木材资源，使用'collect'命令收集，累计收集5个木材后任务完成。每次'collect'命令可获得1个木材，需要执行5次成功的收集操作

6. **采集草药**
   - **描述**: 客栈老板需要一些草药来制作药剂
   - **目标**: 收集草药 (3个)
   - **触发条件**: 与客栈老板对话
   - **奖励**: 经验值60, 侠义值5, 治疗药水(生命恢复+30)
   - **完成方法**: 在森林或草药生长区域寻找草药资源，使用'collect'命令收集，累计收集3个草药后任务完成。每次'collect'命令可获得1个草药，需要执行3次成功的收集操作

7. **森林异变**
   - **描述**: 森林中的动物行为异常，需要调查原因
   - **目标**: 调查森林异常
   - **触发条件**: 与老猎人对话
   - **奖励**: 经验值120, 侠义值8, 猎人徽章(防御力+5)
   - **完成方法**: 进入森林区域，系统会提示3个调查点，在森林中探索并依次触发这3个调查事件，完成所有3个调查点后任务自动完成

8. **山顶净化**
   - **描述**: 山顶被邪恶力量污染，需要帮助隐士进行净化仪式
   - **目标**: 净化山顶
   - **触发条件**: 与隐士对话
   - **奖励**: 经验值150, 侠义值15, 净化法杖(攻击力+12)
   - **完成方法**: 携带3种净化材料（通常需要从之前任务中获取）前往山顶，找到隐士后与之对话，按照系统提示依次完成5个步骤的净化仪式，成功完成所有仪式步骤后任务完成

9. **客栈护卫**
   - **描述**: 客栈老板担心野狼威胁客栈安全，需要你清理森林中的野狼
   - **目标**: 保护客栈，击败野狼 (2个)
   - **触发条件**: 与客栈老板对话
   - **奖励**: 经验值100, 侠义值12, 特制美酒(生命恢复+25)
   - **完成方法**: 在森林区域寻找野狼并击败它们，系统会自动记录击杀数量，累计击败2只野狼后任务完成

10. **珍贵矿石**
    - **描述**: 铁匠需要山洞中的珍贵矿石来打造高级装备
    - **目标**: 寻找矿石 (1个)
    - **触发条件**: 与铁匠对话
    - **奖励**: 经验值80, 侠义值10, 精钢护甲(防御力+10)
    - **完成方法**: 进入山洞深处寻找矿石资源点，使用'collect'命令采集矿石，只需成功采集1个矿石后任务完成

11. **古庙祈福**
    - **描述**: 古庙的老和尚邀请你参拜，据说能获得佛祖庇佑
    - **目标**: 参拜古庙
    - **触发条件**: 与老和尚对话
    - **奖励**: 经验值90, 侠义值7, 祈福符(增加幸运值)
    - **完成方法**: 进入古庙区域，找到老和尚并与其对话1次，然后按照提示完成3个步骤的参拜仪式，完成所有参拜步骤后任务自动完成

12. **商人的请求**
    - **描述**: 旅行商人需要一些稀有物品，愿意用珍贵商品交换
    - **目标**: 与商人交易
    - **触发条件**: 与旅行商人对话
    - **奖励**: 经验值110, 侠义值9, 商人的货物
    - **完成方法**: 携带商人所需的3件特定物品（通常在对话中会说明），找到旅行商人后使用'trade'命令进行1次交易，交易成功后任务完成

13. **稀有草药**
    - **描述**: 药师需要一些稀有草药来配制特殊药剂
    - **目标**: 采集稀有草药 (5个)
    - **触发条件**: 与药师对话
    - **奖励**: 经验值130, 侠义值11, 药师的药剂(生命恢复+40)
    - **完成方法**: 在特定的高级草药区域（通常在对话中会提示位置）寻找稀有草药，使用'collect'命令采集，累计采集5个稀有草药后任务完成。每次'collect'命令可获得1个稀有草药，需要执行5次成功的收集操作

14. **武师考验**
    - **描述**: 武师要求你先证明自己的实力，击败竹林中的盗贼
    - **目标**: 通过武师考验，击败竹林盗贼 (1个)
    - **触发条件**: 与武师对话
    - **奖励**: 经验值160, 侠义值14, 武师秘籍(学会新技能)
    - **完成方法**: 进入竹林区域，找到并击败1名竹林盗贼，系统会自动记录击杀，成功击败后任务完成

15. **湖心亭之谜**
    - **描述**: 湖心亭最近出现奇怪的光芒，书生希望你能调查
    - **目标**: 调查湖心亭
    - **触发条件**: 与书生对话
    - **奖励**: 经验值95, 侠义值6, 书生的诗集(增加文化修养)
    - **完成方法**: 前往湖边区域，进入湖心亭进行调查，与亭中的4个异常现象互动，完成所有4个调查步骤后任务自动完成

16. **竹林清修**
    - **描述**: 竹林中的盗贼扰乱了隐士的清修，需要你帮忙驱赶
    - **目标**: 驱赶竹林盗贼 (1个)
    - **触发条件**: 与女隐士对话
    - **奖励**: 经验值140, 侠义值12, 隐士的信物(可进入神秘地点)
    - **完成方法**: 进入竹林区域，找到并击败1名扰乱清修的竹林盗贼，系统会自动记录击杀，成功击败后任务完成

17. **怨灵净化**
    - **描述**: 废弃小屋中的怨灵需要被净化，才能获得安宁
    - **目标**: 净化废弃小屋，击败怨灵 (1个)
    - **触发条件**: 与女隐士对话
    - **奖励**: 经验值170, 侠义值16, 净化宝珠(神秘力量+15)
    - **完成方法**: 携带1个净化道具（从之前任务中获取）前往废弃小屋，与1只怨灵战斗并击败它，战斗胜利后系统自动完成净化过程，任务随即完成

18. **宝藏守护者**
    - **描述**: 地下大厅的守护灵守护着珍贵的宝藏，只有击败它才能获得
    - **目标**: 击败守护灵 (1个)
    - **触发条件**: 进入地下大厅
    - **奖励**: 经验值200, 侠义值20, 宝藏钥匙
    - **完成方法**: 进入地下大厅，找到并与1只守护灵战斗，成功击败守护灵后任务自动完成

19. **隐士的指引**
    - **描述**: 山顶的隐士似乎知道一些秘密，去和他谈谈
    - **目标**: 与隐士对话 (1次)
    - **触发条件**: 与隐士对话
    - **奖励**: 经验值50, 侠义值5, 隐士的智慧
    - **完成方法**: 前往山顶区域，找到隐士并使用'talk'命令与其对话1次，完成对话后任务自动完成

20. **净化材料**
    - **描述**: 隐士需要一些特殊的草药来制作净化药剂
    - **目标**: 收集净化材料，采集草药 (5个)
    - **触发条件**: 与隐士对话
    - **奖励**: 经验值100, 侠义值8, 净化粉末
    - **完成方法**: 在指定区域（通常是森林或高山草药区）寻找净化所需的特殊草药，使用'collect'命令采集，累计收集5个后任务完成。每次'collect'命令可获得1个草药，需要执行5次成功的收集操作

21. **连锁任务 - 隐士的指引后续**
    - **描述**: 基于前面的任务进一步探索
    - **目标**: 完成前序任务后自动触发
    - **奖励**: 经验值120, 侠义值10
    - **完成方法**: 完成"隐士的指引"任务后，系统会自动触发此任务，需要与3个指定NPC对话并收集2个特定物品，按照新任务的指引完成所有目标后任务完成

22. **连锁任务 - 净化材料后续**
    - **描述**: 基于收集的净化材料执行净化仪式
    - **目标**: 完成净化仪式
    - **奖励**: 经验值150, 侠义值15, 特殊物品
    - **完成方法**: 完成"净化材料"任务后，携带之前收集的5个净化材料返回隐士处，按照系统提示依次完成4个步骤的净化仪式，成功完成所有仪式步骤后任务完成

### 3.5 Reward 类
**功能**: 处理任务完成后的奖励发放

- **奖励类型**:
  - 经验值奖励
  - 侠义值奖励
  - 物品奖励

- **发放方法**:
  - `giveReward()`: 根据奖励类型给予玩家对应奖励
  - 显示奖励发放信息

## 4. 战斗系统

### 4.1 EnhancedBattleEngine 类
**功能**: 增强型战斗引擎，支持多敌人战斗

- **战斗初始化**:
  - 设置玩家和敌人队伍
  - 初始化战斗状态和效果

- **回合管理**:
  - 管理玩家和敌人的行动顺序
  - 处理回合开始和结束逻辑

- **玩家行动**:
  - 提供多种行动选择（攻击、技能、防御、物品、逃跑）
  - 通过数字选择（1-5）处理玩家输入

- **敌人行动**:
  - 敌人AI决策和攻击目标选择
  - 根据玩家和自身状态调整策略

- **状态效果处理**:
  - 管理和应用各种状态效果
  - 状态效果回合更新和持续时间管理

- **伤害计算**:
  - 基础伤害计算
  - 暴击机制（1.5倍伤害）
  - 属性克制系统（增加20%伤害）

- **战斗结果**:
  - 胜利条件和奖励发放
  - 失败条件和惩罚

### 4.2 BattleEngine 类
**功能**: 基础战斗引擎，提供核心战斗逻辑

- **战斗流程**:
  - 显示战斗状态和实体信息
  - 玩家行动选择和执行
  - 敌人行动和战斗循环

- **战斗选项**:
  - 攻击、防御、使用物品、逃跑
  - 每个选项的具体实现逻辑

### 4.3 BattleEntity 接口
**功能**: 定义战斗实体的通用属性和方法

- **核心属性**:
  - HP、ATK、DEF等基础战斗属性
  - 元素属性和状态效果

- **通用方法**:
  - 承受伤害、应用状态
  - 状态管理和存活检查

### 4.4 StatusEffect 类
**功能**: 实现战斗中的各种状态效果

- **效果类型**:
  - 中毒、流血、燃烧、回复等8种效果
  - 每种效果有不同的应用逻辑和持续时间

- **效果机制**:
  - 回合开始或结束时触发效果
  - 效果持续时间管理
  - 效果强度和叠加规则

### 4.5 BattleStatus 枚举
**功能**: 定义所有可能的战斗状态

- **状态分类**:
  - 正面状态（如防御提升、生命回复）
  - 负面状态（如中毒、减速）
  - 特殊状态（如眩晕、无敌）

- **状态属性**:
  - 状态名称、图标
  - 正负属性标记
  - 最大持续回合数

## 5. 装备系统

### 5.1 Equipment 类
**功能**: 定义游戏中的装备物品

- **核心属性**:
  - 基础属性（攻击力/防御力）
  - 品质等级
  - 等级和最大等级
  - 耐久度

- **主要方法**:
  - `upgrade()`: 装备强化方法
  - `repair()`: 装备修复方法
  - 计算强化成功率和费用

### 5.2 EquipmentGrade 枚举
**功能**: 定义装备的品质等级系统

- **品质等级**:
  - 普通（COMMON）
  - 优秀（UNCOMMON）
  - 稀有（RARE）
  - 史诗（EPIC）
  - 传说（LEGENDARY）
  - 神话（MYTHIC）

- **品质属性**:
  - 效果倍率
  - 基础耐久度
  - 基础成功率
  - 基础升级费用
  - 每点耐久修复费用

- **品质生成机制**:
  - 随机生成品质的概率分布：
    - 普通：50%
    - 优秀：25%
    - 稀有：15%
    - 史诗：7%
    - 传说：2%
    - 神话：1%

### 5.3 EquipmentManager 类
**功能**: 管理装备系统的各项功能

- **装备模板管理**:
  - 初始化各类装备模板
  - 提供武器和护甲类装备

- **强化系统**:
  - 检查强化条件（金币、等级上限、耐久度）
  - 执行装备强化
  - 返回强化结果

- **修复系统**:
  - 检查修复条件
  - 执行装备修复
  - 返回修复结果

### 5.4 UpgradeResult 和 RepairResult 类
**功能**: 处理装备强化和修复的结果

- **核心属性**:
  - 成功状态（boolean）
  - 结果消息

- **输出格式**:
  - 带成功/失败图标的格式化输出
  - 详细说明操作结果

## 6. 命令系统和存档系统

### 6.1 命令系统
**功能**: 处理玩家输入和命令解析

- **输入处理机制**:
  - 在战斗系统中通过数字选择（1-5）处理玩家行动
  - 在主菜单中通过数字选择（1-4）处理功能选择
  - 验证用户输入并提供错误处理

- **命令执行**:
  - 通过switch-case分支执行对应功能
  - 处理各种命令参数和格式

### 6.2 存档系统
**功能**: 管理游戏进度的保存和加载

#### 6.2.1 DataManager 类
**功能**: 核心存档数据管理

- **存档目录**:
  - 保存目录："saves/"
  - 文件扩展名：".dat"

- **存档功能**:
  - `saveGame()`: 保存游戏进度到文件
  - 创建SaveData对象，序列化玩家数据
  - 保存时间戳和游戏版本
  - 保存NPC血量状态：通过Player类中的npcHealthMap字段记录所有NPC的当前血量

- **加载功能**:
  - `loadGame()`: 从文件加载游戏进度
  - 反序列化存档数据，恢复玩家状态
  - 恢复NPC血量状态：GameLauncher类的restoreLoadedGame方法会调用restoreNpcHealth方法，遍历所有房间的NPC并根据保存的数据恢复其血量

- **存档管理**:
  - `getAvailableSaves()`: 获取所有可用存档
  - `deleteSave()`: 删除指定存档
  - `showSaveInfo()`: 显示存档详细信息

#### 6.2.2 SaveData 内部类
**功能**: 封装需要保存的数据

- **保存内容**:
  - Player对象（玩家状态、装备、物品等）
  - 保存时间
  - 游戏版本

#### 6.2.3 GameLoader 类
**功能**: 提供存档加载界面和管理功能

- **加载菜单**:
  - 显示可用存档列表
  - 允许玩家选择和确认加载
  - 显示存档详情

- **存档管理菜单**:
  - 查看所有存档
  - 查看存档详情
  - 删除存档

- **用户交互**:
  - 支持按编号或名称选择存档
  - 提供确认机制防止误操作
  - 输入验证和错误处理

## 7. 游戏流程概述

1. **游戏启动**:
   - GameLauncher显示主菜单
   - 玩家选择新游戏、加载游戏或管理存档

2. **游戏初始化**:
   - 创建玩家角色
   - 初始化地图、任务和物品
   - 设置初始位置和状态

3. **主游戏循环**:
   - 显示当前房间信息
   - 处理玩家命令输入
   - 执行相应操作（移动、交互、战斗等）
   - 更新游戏状态

4. **战斗流程**:
   - 触发战斗事件
   - 进入战斗循环
   - 玩家选择行动
   - 敌人执行行动
   - 计算伤害和状态变化
   - 处理战斗结果

5. **任务系统**:
   - 触发和接受任务
   - 更新任务进度
   - 完成任务并获取奖励

6. **装备系统**:
   - 强化和修复装备
   - 管理装备属性和效果

7. **存档管理**:
   - 保存当前游戏进度
   - 加载之前的游戏进度
   - 管理存档文件

## 8. 游戏特色系统

### 8.1 多系统协同工作
- 战斗系统与任务系统集成（战斗结果影响任务进度）
- 装备系统影响战斗能力
- 存档系统保存所有游戏进度

### 8.2 策略性战斗
- 多种状态效果组合
- 属性克制系统
- 暴击机制增加战斗变数

### 8.3 任务网络
- 3条主线任务和19条支线任务
- 多样化的任务目标（击杀、收集、探索、对话）
- 丰厚的任务奖励机制

### 8.4 装备进阶
- 6级品质系统，带有概率分布
- 强化和修复系统增加装备寿命
- 不同品质装备有不同属性成长

## 9. 总结

本游戏是一个功能完整的MUD(Multi-User Dungeon)类游戏，具有丰富的游戏机制和系统。游戏采用模块化设计，各系统之间协同工作，为玩家提供完整的游戏体验。核心系统包括地图管理、战斗、任务、装备和存档等，共同构成了一个完整的游戏世界。游戏的战斗系统具有策略性，任务系统提供了多样的游戏目标，装备系统增加了游戏的养成要素，存档系统确保了玩家可以随时保存和继续游戏。